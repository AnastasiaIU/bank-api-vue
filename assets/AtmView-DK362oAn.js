import{C as D,r as m,a as I,B as L,D as P,q as v,A as b,x as N,y as M,c as A,d as y,e as R,f as E,g as f,i as o,S as U,h as T,t as _,E as k,w as x,F as B}from"./index-BqQshk00.js";import{T as C}from"./Toast-4gijut1s.js";import{A as O}from"./AccountDropdown-C4lcHUmT.js";import{c as F,h as V,u as $,_ as K}from"./rules-Dw0mSE7w.js";import{p as W}from"./formatters-DwE89AP2.js";const q=F({amount:V}),z=D("atm-transaction",()=>{const s=m([]),c=m(!1),i=m(null),n=I(),g=L();async function d(a){const t=await v.post(b.atmTransactions,a);return s.value.push(t.data),t}async function S(a){return(await v.get(b.atmTransactionsById(a))).data}async function h(a){const t=Date.now();for(;Date.now()-t<1e4;){const e=await S(a);if(e.status!=="PENDING")return e;await new Promise(u=>setTimeout(u,4e3))}throw new Error("Transaction status check timed out.")}async function p(a){l();const t=Date.now();c.value=!0;try{const e=await d(a),u=await h(e.data.id);return u.status==="SUCCEEDED"?(await g.fetchUserAccounts(n.user.id),{message:a.type==="WITHDRAW"?"Transaction succeeded. Money dispensed.":"Transaction succeeded. Money deposited.",type:"success"}):{message:u.failureReason||"Transaction failed.",type:"error"}}catch(e){i.value=e?.response?.data?.message||e?.message||"An error occurred. Please try again."}finally{await P(t),c.value=!1}}function l(){i.value=null,c.value=!1}return{processTransaction:p,isLoading:c,error:i,clearUiState:l}}),G={class:"card col-md-6 col-lg-5 col-xl-4 p-4 m-4"},H={class:"h2 text-center"},Z={key:0,class:"alert alert-danger",role:"alert"},j=["disabled"],J={__name:"AtmForm",props:{transactionType:String},setup(r){const w=L(),s=z(),c=N(),i=m(null),n=m(null),g=r,d=$({validationSchema:q}),{handleSubmit:S,meta:h}=d,p=S(async a=>{const t={iban:n.value.iban,type:g.transactionType.toUpperCase(),amount:W(a.amount)},{message:e,type:u}=await s.processTransaction(t);i.value.setToast(e,u),l()});M(()=>c.fullPath,()=>{l()});function l(){n.value=null,d.resetForm(),s.clearUiState()}return(a,t)=>(y(),A(B,null,[o(s).isLoading?(y(),R(U,{key:0,size:"md",message:"Creating the transaction..."})):E("",!0),f("section",G,[f("h1",H,_(r.transactionType),1),o(s).error?(y(),A("div",Z,_(o(s).error),1)):E("",!0),f("form",{class:"d-flex flex-column gap-2",onSubmit:t[1]||(t[1]=x((...e)=>o(p)&&o(p)(...e),["prevent"])),onKeydown:t[2]||(t[2]=k(x(()=>{},["prevent"]),["enter"]))},[T(O,{accounts:o(w).userAccounts,selectedAccount:n.value,"onUpdate:selectedAccount":t[0]||(t[0]=e=>n.value=e),label:"Select an account"},null,8,["accounts","selectedAccount"]),T(K,{name:"amount",label:"Enter amount",type:"currency"}),f("button",{class:"btn btn-primary my-3 fw-bold",disabled:!o(h).valid||n.value===null},_(r.transactionType),9,j)],32),T(C,{ref_key:"toastRef",ref:i,text:""},null,512)])],64))}},Q={class:"container-fluid d-flex flex-column flex-grow-1 align-items-center p-0"},nt={__name:"AtmView",props:{transactionType:String},setup(r){return(w,s)=>(y(),A("main",Q,[T(J,{transactionType:r.transactionType},null,8,["transactionType"])]))}};export{nt as default};
