import{z as I,r as d,a as N,y as P,B as U,q as x,A as E,C as k,x as B,c as v,d as T,e as C,f as L,g as y,i as r,S as O,h as w,t as A,D as R,w as D,F}from"./index-DWyc0-Aj.js";import{T as V}from"./Toast-cqWzQQjH.js";import{A as M}from"./AccountDropdown-D1i48znx.js";import{c as $,i as z,u as K,_ as q}from"./rules-CK4UMEM4.js";import{p as G}from"./formatters-DwE89AP2.js";const Z=$({amount:z}),j=I("atm-transaction",()=>{const n=d([]),i=d(!1),u=d(null),o=N(),g=P();async function p(a){const t=await x.post(E.atmTransactions,a);return n.value.push(t.data),t}async function _(a){return(await x.get(E.atmTransactionsById(a))).data}async function h(a){const t=Date.now();for(;Date.now()-t<1e4;){const e=await _(a);if(e.status!=="PENDING")return e;await new Promise(l=>setTimeout(l,4e3))}throw new Error("Transaction status check timed out.")}async function f(a){var e,l;m();const t=Date.now();i.value=!0;try{const s=await p(a),b=await h(s.data.id);return b.status==="SUCCEEDED"?(await g.fetchUserAccounts(o.user.id),{message:"Transaction succeeded. Money dispensed.",type:"success"}):{message:b.failureReason||"Transaction failed.",type:"error"}}catch(s){u.value=((l=(e=s==null?void 0:s.response)==null?void 0:e.data)==null?void 0:l.message)||(s==null?void 0:s.message)||"An error occurred. Please try again."}finally{await U(t),i.value=!1}}function m(){u.value=null,i.value=!1}return{processTransaction:f,isLoading:i,error:u,clearUiState:m}}),H={class:"card col-md-6 col-lg-5 col-xl-4 p-4 m-4"},J={class:"h2 text-center"},Q={key:0,class:"alert alert-danger",role:"alert"},W=["disabled"],X={__name:"AtmForm",props:{transactionType:String},setup(c){const S=P(),n=j(),i=k(),u=d(null),o=d(null),g=c,p=K({validationSchema:Z}),{handleSubmit:_,meta:h}=p,f=_(async a=>{const t={iban:o.value.iban,type:g.transactionType.toUpperCase(),amount:G(a.amount)},{message:e,type:l}=await n.processTransaction(t);u.value.setToast(e,l),m()});B(()=>i.fullPath,()=>{m()});function m(){o.value=null,p.resetForm(),n.clearUiState()}return(a,t)=>(T(),v(F,null,[r(n).isLoading?(T(),C(O,{key:0,size:"md",message:"Creating the transaction..."})):L("",!0),y("section",H,[y("h1",J,A(c.transactionType),1),r(n).error?(T(),v("div",Q,A(r(n).error),1)):L("",!0),y("form",{class:"d-flex flex-column gap-2",onSubmit:t[1]||(t[1]=D((...e)=>r(f)&&r(f)(...e),["prevent"])),onKeydown:t[2]||(t[2]=R(D(()=>{},["prevent"]),["enter"]))},[w(M,{accounts:r(S).userAccounts,selectedAccount:o.value,"onUpdate:selectedAccount":t[0]||(t[0]=e=>o.value=e),label:"Select an account"},null,8,["accounts","selectedAccount"]),w(q,{name:"amount",label:"Enter amount",type:"currency"}),y("button",{class:"btn btn-primary my-3 fw-bold",disabled:!r(h).valid||o.value===null},A(c.transactionType),9,W)],32),w(V,{ref_key:"toastRef",ref:u,text:""},null,512)])],64))}},Y={class:"container-fluid d-flex flex-column flex-grow-1 align-items-center p-0"},ot={__name:"AtmView",props:{transactionType:String},setup(c){return(S,n)=>(T(),v("main",Y,[w(X,{transactionType:c.transactionType},null,8,["transactionType"])]))}};export{ot as default};
