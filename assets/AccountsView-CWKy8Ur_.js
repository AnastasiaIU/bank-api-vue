import{y as $,c as d,d as u,g as t,w as R,i as o,h as v,p as D,a as F,B as I,r as _,f as C,e as M,t as r,F as S,z as U,j as x,q as V,A as j,u as z,R as q,n as Z}from"./index-Baxu7pPT.js";import{f as h,p as A}from"./formatters-DwE89AP2.js";import{c as Y,i as E,k as G,u as H,_ as k}from"./rules-C8-DGxJY.js";import{T as J}from"./Toast-BS425cEl.js";const K=Y({dailyLimit:E,absoluteLimit:G,withdrawLimit:E}),Q={class:"modal fade show",tabindex:"-1",style:{display:"block"},"aria-modal":"true",role:"dialog"},W={class:"modal-dialog modal-dialog-centered"},X={class:"modal-content"},tt={class:"modal-header"},et={class:"modal-body"},st={class:"modal-footer"},at={__name:"UpdateLimitsModal",props:{account:{type:Object,required:!0}},emits:["close","submit"],setup(L,{emit:b}){const a=L,g=H({validationSchema:K}),{handleSubmit:c,resetForm:e}=g,p=b;$(()=>a.account,s=>{s&&e({values:{dailyLimit:s.dailyLimit?h(s.dailyLimit):"",absoluteLimit:s.absoluteLimit!==null&&s.absoluteLimit!==void 0?h(s.absoluteLimit):"",withdrawLimit:s.withdrawLimit?h(s.withdrawLimit):""}})},{immediate:!0});const m=c(async s=>{p("submit",{iban:a.account.iban,dailyLimit:A(s.dailyLimit),absoluteLimit:A(s.absoluteLimit),withdrawLimit:A(s.withdrawLimit)})});return(s,i)=>(u(),d("div",null,[t("div",Q,[t("div",W,[t("div",X,[t("form",{onSubmit:i[2]||(i[2]=R((...f)=>o(m)&&o(m)(...f),["prevent"]))},[t("div",tt,[i[3]||(i[3]=t("h5",{class:"modal-title"},"Update Account Limits",-1)),t("button",{type:"button",class:"btn-close",onClick:i[0]||(i[0]=f=>s.$emit("close")),"aria-label":"Close"})]),t("div",et,[v(k,{name:"dailyLimit",label:"Enter daily limit",type:"currency"}),v(k,{name:"absoluteLimit",label:"Enter absolute limit",type:"currency"}),v(k,{name:"withdrawLimit",label:"Enter withdraw limit",type:"currency"})]),t("div",st,[t("button",{type:"button",class:"btn btn-secondary",onClick:i[1]||(i[1]=f=>s.$emit("close"))}," Cancel "),i[4]||(i[4]=t("button",{type:"submit",class:"btn btn-primary"}," Save Changes ",-1))])],32)])])]),i[5]||(i[5]=t("div",{class:"modal-backdrop fade show"},null,-1))]))}},it={key:0,class:"container my-5"},lt={class:"d-flex justify-content-between align-items-center mb-4"},ot=["disabled"],nt={class:"d-flex gap-2"},ut=["disabled"],rt=["disabled"],dt={key:0,class:"alert alert-danger text-center"},ct={key:1,class:"table table-light table-bordered table-hover text-center align-middle"},mt=["onClick"],bt={key:1},pt={"aria-label":"Page navigation example",class:"d-flex justify-content-center mt-4 align-items-center gap-3"},ft=["disabled"],vt={class:"text-muted fw-semibold"},yt=["disabled"],_t=10,ht={__name:"AccountsList",setup(L){const b=F(),a=I(),g=z(),c=_(0),e=_(null),p=_(!1),m=_(null);function s(y){e.value=y}function i(){e.value&&(p.value=!0)}async function f(){await V.delete(j.closeAccount(e.value.iban),{headers:{Authorization:`Bearer ${b.token}`}}),e.value=null,await w()}async function N(y){try{(await a.updateAccountLimits(y)).status===200?(p.value=!1,await w(),e.value=null,m.value.setToast("Account Limits Updated Successfully","success")):m.value.setToast("Failed to update account limits","error")}catch{m.value.setToast("Failed to update account limits","error")}}async function w(){a.fetchAllAccounts(c.value,_t)}$(c,w,{immediate:!0});function P(){c.value>0&&c.value--}function T(){a.isLastPage.value||c.value++}function O(){e.value&&g.push({name:q.EMPLOYEE_TRANSACTIONS,params:{accountId:e.value.id},query:{iban:e.value.iban}})}return(y,l)=>(u(),d(S,null,[o(b).isAuthenticated&&o(b).isEmployee?(u(),d("div",it,[t("div",lt,[l[1]||(l[1]=t("h1",{class:"h2 m-0"},"All Customer Bank Accounts",-1)),t("button",{class:"btn btn-danger",onClick:f,disabled:!e.value||e.value.status==="CLOSED"}," Close Account ",8,ot),t("div",nt,[t("button",{class:"btn btn-primary",onClick:i,disabled:!e.value||e.value.status==="CLOSED"}," Update Account Limits ",8,ut),t("button",{class:"btn btn-primary",disabled:!e.value||e.value.status==="CLOSED",onClick:O}," View Transactions ",8,rt)])]),o(a).error?(u(),d("div",dt,r(o(a).error),1)):(u(),d("table",ct,[l[3]||(l[3]=t("thead",{class:"table-success"},[t("tr",null,[t("th",null,"Customer Name"),t("th",null,"IBAN"),t("th",null,"Type"),t("th",null,"Balance"),t("th",null,"Status")])],-1)),t("tbody",null,[o(a).userAccounts.length>0?(u(!0),d(S,{key:0},U(o(a).userAccounts,(n,B)=>(u(),d("tr",{key:B,class:Z(["clickable-row",{"table-active":e.value?.iban===n.iban},{"text-muted no-pointer":n.status==="CLOSED"}]),onClick:wt=>n.status!=="CLOSED"&&s(n)},[t("td",null,r(n.firstName)+" "+r(n.lastName),1),t("td",null,r(n.iban),1),t("td",null,r(n.type),1),t("td",null,r(o(h)(n.balance)),1),t("td",null,r(n.status),1)],10,mt))),128)):(u(),d("tr",bt,l[2]||(l[2]=[t("td",{colspan:"4",class:"text-center text-muted fw-semibold"}," No accounts found. ",-1)])))])])),t("nav",pt,[t("button",{class:"btn btn-outline-primary",onClick:P,disabled:o(a).isFirstPage,title:"Previous Page"},l[4]||(l[4]=[t("i",{class:"bi bi-chevron-left"},null,-1),x(" Previous ")]),8,ft),t("span",vt," Page "+r(c.value+1)+" of "+r(o(a).totalPages),1),t("button",{class:"btn btn-outline-primary",onClick:T,disabled:o(a).isLastPage,title:"Next Page"},l[5]||(l[5]=[x(" Next "),t("i",{class:"bi bi-chevron-right"},null,-1)]),8,yt)])])):C("",!0),p.value?(u(),M(at,{key:1,account:e.value,onClose:l[0]||(l[0]=n=>p.value=!1),onSubmit:N},null,8,["account"])):C("",!0),v(J,{ref_key:"toastRef",ref:m},null,512)],64))}},Lt=D(ht,[["__scopeId","data-v-f48f193c"]]),gt={class:"container-fluid d-flex flex-column flex-grow-1 align-items-center p-0"},xt={__name:"AccountsView",setup(L){return(b,a)=>(u(),d("main",gt,[v(Lt)]))}};export{xt as default};
