import{B as D,r as m,a as P,z as L,C as I,q as v,A as b,s as N,x as U,c as A,d as y,e as k,f as x,g as f,i as o,S as B,h as T,t as h,D as C,w as E,F as O}from"./index-ZX3uO6H3.js";import{T as R}from"./Toast-B6FA6vjR.js";import{A as F}from"./AccountDropdown-CtqVc2P6.js";import{c as V,i as M,u as $,_ as z}from"./rules-BPMM-q5A.js";import{p as K}from"./formatters-DwE89AP2.js";const q=V({amount:M}),G=D("atm-transaction",()=>{const n=m([]),c=m(!1),i=m(null),s=P(),S=L();async function d(a){const t=await v.post(b.atmTransactions,a);return n.value.push(t.data),t}async function g(a){return(await v.get(b.atmTransactionsById(a))).data}async function _(a){const t=Date.now();for(;Date.now()-t<1e4;){const e=await g(a);if(e.status!=="PENDING")return e;await new Promise(u=>setTimeout(u,4e3))}throw new Error("Transaction status check timed out.")}async function p(a){l();const t=Date.now();c.value=!0;try{const e=await d(a),u=await _(e.data.id);return u.status==="SUCCEEDED"?(await S.fetchUserAccounts(s.user.id),{message:"Transaction succeeded. Money dispensed.",type:"success"}):{message:u.failureReason||"Transaction failed.",type:"error"}}catch(e){i.value=e?.response?.data?.message||e?.message||"An error occurred. Please try again."}finally{await I(t),c.value=!1}}function l(){i.value=null,c.value=!1}return{processTransaction:p,isLoading:c,error:i,clearUiState:l}}),Z={class:"card col-md-6 col-lg-5 col-xl-4 p-4 m-4"},j={class:"h2 text-center"},H={key:0,class:"alert alert-danger",role:"alert"},J=["disabled"],Q={__name:"AtmForm",props:{transactionType:String},setup(r){const w=L(),n=G(),c=N(),i=m(null),s=m(null),S=r,d=$({validationSchema:q}),{handleSubmit:g,meta:_}=d,p=g(async a=>{const t={iban:s.value.iban,type:S.transactionType.toUpperCase(),amount:K(a.amount)},{message:e,type:u}=await n.processTransaction(t);i.value.setToast(e,u),l()});U(()=>c.fullPath,()=>{l()});function l(){s.value=null,d.resetForm(),n.clearUiState()}return(a,t)=>(y(),A(O,null,[o(n).isLoading?(y(),k(B,{key:0,size:"md",message:"Creating the transaction..."})):x("",!0),f("section",Z,[f("h1",j,h(r.transactionType),1),o(n).error?(y(),A("div",H,h(o(n).error),1)):x("",!0),f("form",{class:"d-flex flex-column gap-2",onSubmit:t[1]||(t[1]=E((...e)=>o(p)&&o(p)(...e),["prevent"])),onKeydown:t[2]||(t[2]=C(E(()=>{},["prevent"]),["enter"]))},[T(F,{accounts:o(w).userAccounts,selectedAccount:s.value,"onUpdate:selectedAccount":t[0]||(t[0]=e=>s.value=e),label:"Select an account"},null,8,["accounts","selectedAccount"]),T(z,{name:"amount",label:"Enter amount",type:"currency"}),f("button",{class:"btn btn-primary my-3 fw-bold",disabled:!o(_).valid||s.value===null},h(r.transactionType),9,J)],32),T(R,{ref_key:"toastRef",ref:i,text:""},null,512)])],64))}},W={class:"container-fluid d-flex flex-column flex-grow-1 align-items-center p-0"},nt={__name:"AtmView",props:{transactionType:String},setup(r){return(w,n)=>(y(),A("main",W,[T(Q,{transactionType:r.transactionType},null,8,["transactionType"])]))}};export{nt as default};
