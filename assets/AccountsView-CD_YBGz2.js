import{x as N,c as r,d as n,g as t,w as B,i as o,h as v,p as F,a as U,z as V,r as h,f as x,e as j,t as d,F as C,y as z,j as $,q as I,A as M,n as R}from"./index-hq2crXK7.js";import{f as L,p as w}from"./formatters-DwE89AP2.js";import{c as q,i as S,k as D,u as O,_ as A}from"./rules-CEdIoZ_B.js";import{T as Z}from"./Toast-B9WflNqO.js";const G=q({dailyLimit:S,absoluteLimit:D,withdrawLimit:S}),H={class:"modal fade show",tabindex:"-1",style:{display:"block"},"aria-modal":"true",role:"dialog"},J={class:"modal-dialog modal-dialog-centered"},K={class:"modal-content"},Q={class:"modal-header"},W={class:"modal-body"},X={class:"modal-footer"},Y={__name:"UpdateLimitsModal",props:{account:{type:Object,required:!0}},emits:["close","submit"],setup(g,{emit:m}){const s=g,u=O({validationSchema:G}),{handleSubmit:l,resetForm:b}=u,p=m;N(()=>s.account,e=>{e&&b({values:{dailyLimit:e.dailyLimit?L(e.dailyLimit):"",absoluteLimit:e.absoluteLimit?L(e.absoluteLimit):"",withdrawLimit:e.withdrawLimit?L(e.withdrawLimit):""}})},{immediate:!0});const y=l(async e=>{p("submit",{iban:s.account.iban,dailyLimit:w(e.dailyLimit),absoluteLimit:w(e.absoluteLimit),withdrawLimit:w(e.withdrawLimit)})});return(e,a)=>(n(),r("div",null,[t("div",H,[t("div",J,[t("div",K,[t("form",{onSubmit:a[2]||(a[2]=B((...f)=>o(y)&&o(y)(...f),["prevent"]))},[t("div",Q,[a[3]||(a[3]=t("h5",{class:"modal-title"},"Update Account Limits",-1)),t("button",{type:"button",class:"btn-close",onClick:a[0]||(a[0]=f=>e.$emit("close")),"aria-label":"Close"})]),t("div",W,[v(A,{name:"dailyLimit",label:"Enter daily limit",type:"currency"}),v(A,{name:"absoluteLimit",label:"Enter absolute limit",type:"currency"}),v(A,{name:"withdrawLimit",label:"Enter withdraw limit",type:"currency"})]),t("div",X,[t("button",{type:"button",class:"btn btn-secondary",onClick:a[1]||(a[1]=f=>e.$emit("close"))}," Cancel "),a[4]||(a[4]=t("button",{type:"submit",class:"btn btn-primary"}," Save Changes ",-1))])],32)])])]),a[5]||(a[5]=t("div",{class:"modal-backdrop fade show"},null,-1))]))}},tt={key:0,class:"container my-5"},et={class:"d-flex justify-content-between align-items-center mb-4"},st=["disabled"],at=["disabled"],it={key:0,class:"alert alert-danger text-center"},ot={key:1,class:"table table-light table-bordered table-hover text-center align-middle"},lt=["onClick"],nt={key:1},rt={"aria-label":"Page navigation example",class:"d-flex justify-content-center mt-4 align-items-center gap-3"},ut=["disabled"],ct={class:"text-muted fw-semibold"},dt=["disabled"],mt=10,bt={__name:"AccountsList",setup(g){const m=U(),s=V(),u=h(0),l=h(null),b=h(!1),p=h(null);function y(_){l.value=_}function e(){l.value&&(b.value=!0)}async function a(){await I.delete(M.closeAccount(l.value.iban),{headers:{Authorization:`Bearer ${m.token}`}})}async function f(_){try{(await s.updateAccountLimits(_)).status===200?(b.value=!1,await k(),l.value=null,p.value.setToast("Account Limits Updated Successfully","success")):p.value.setToast("Failed to update account limits","error")}catch{p.value.setToast("Failed to update account limits","error")}}async function k(){s.fetchAllAccounts(u.value,mt)}N(u,k,{immediate:!0});function P(){u.value>0&&u.value--}function E(){s.isLastPage.value||u.value++}return(_,i)=>(n(),r(C,null,[o(m).isAuthenticated&&o(m).isEmployee?(n(),r("div",tt,[t("div",et,[i[1]||(i[1]=t("h1",{class:"h2 m-0"},"Customer Accounts",-1)),t("button",{class:"btn btn-danger",onClick:a,disabled:!l.value}," Close Account ",8,st),t("button",{class:"btn btn-primary",onClick:e,disabled:!l.value}," Update Account Limits ",8,at)]),o(s).error?(n(),r("div",it,d(o(s).error),1)):(n(),r("table",ot,[i[3]||(i[3]=t("thead",{class:"table-success"},[t("tr",null,[t("th",null,"Customer Name"),t("th",null,"IBAN"),t("th",null,"Type"),t("th",null,"Balance")])],-1)),t("tbody",null,[o(s).userAccounts.length>0?(n(!0),r(C,{key:0},z(o(s).userAccounts,(c,T)=>(n(),r("tr",{key:T,class:R(["clickable-row",{"table-active":l.value?.iban===c.iban}]),onClick:vt=>y(c)},[t("td",null,d(c.firstName)+" "+d(c.lastName),1),t("td",null,d(c.iban),1),t("td",null,d(c.type),1),t("td",null,d(o(L)(c.balance)),1)],10,lt))),128)):(n(),r("tr",nt,i[2]||(i[2]=[t("td",{colspan:"4",class:"text-center text-muted fw-semibold"}," No accounts found. ",-1)])))])])),t("nav",rt,[t("button",{class:"btn btn-outline-primary",onClick:P,disabled:o(s).isFirstPage,title:"Previous Page"},i[4]||(i[4]=[t("i",{class:"bi bi-chevron-left"},null,-1),$(" Previous ")]),8,ut),t("span",ct," Page "+d(u.value+1)+" of "+d(o(s).totalPages),1),t("button",{class:"btn btn-outline-primary",onClick:E,disabled:o(s).isLastPage,title:"Next Page"},i[5]||(i[5]=[$(" Next "),t("i",{class:"bi bi-chevron-right"},null,-1)]),8,dt)])])):x("",!0),b.value?(n(),j(Y,{key:1,account:l.value,onClose:i[0]||(i[0]=c=>b.value=!1),onSubmit:f},null,8,["account"])):x("",!0),v(Z,{ref_key:"toastRef",ref:p},null,512)],64))}},pt=F(bt,[["__scopeId","data-v-f055a6be"]]),ft={class:"container-fluid d-flex flex-column flex-grow-1 align-items-center p-0"},gt={__name:"AccountsView",setup(g){return(m,s)=>(n(),r("main",ft,[v(pt)]))}};export{gt as default};
