import{y as N,c as r,d as l,g as t,w as F,i as n,h as v,p as I,a as M,B as U,r as _,f as x,e as V,t as d,F as C,z as O,j as S,q as j,A as z,u as q,R as D,n as Z}from"./index-D-pwlFFi.js";import{f as h,p as w}from"./formatters-DwE89AP2.js";import{c as Y,i as $,k as G,u as H,_ as A}from"./rules-nNSFYsCq.js";import{T as J}from"./Toast-CTsbt6tg.js";const K=Y({dailyLimit:$,absoluteLimit:G,withdrawLimit:$}),Q={class:"modal fade show",tabindex:"-1",style:{display:"block"},"aria-modal":"true",role:"dialog"},W={class:"modal-dialog modal-dialog-centered"},X={class:"modal-content"},tt={class:"modal-header"},et={class:"modal-body"},st={class:"modal-footer"},at={__name:"UpdateLimitsModal",props:{account:{type:Object,required:!0}},emits:["close","submit"],setup(L,{emit:b}){const s=L,g=H({validationSchema:K}),{handleSubmit:u,resetForm:a}=g,p=b;N(()=>s.account,e=>{e&&a({values:{dailyLimit:e.dailyLimit?h(e.dailyLimit):"",absoluteLimit:e.absoluteLimit?h(e.absoluteLimit):"",withdrawLimit:e.withdrawLimit?h(e.withdrawLimit):""}})},{immediate:!0});const m=u(async e=>{p("submit",{iban:s.account.iban,dailyLimit:w(e.dailyLimit),absoluteLimit:w(e.absoluteLimit),withdrawLimit:w(e.withdrawLimit)})});return(e,i)=>(l(),r("div",null,[t("div",Q,[t("div",W,[t("div",X,[t("form",{onSubmit:i[2]||(i[2]=F((...f)=>n(m)&&n(m)(...f),["prevent"]))},[t("div",tt,[i[3]||(i[3]=t("h5",{class:"modal-title"},"Update Account Limits",-1)),t("button",{type:"button",class:"btn-close",onClick:i[0]||(i[0]=f=>e.$emit("close")),"aria-label":"Close"})]),t("div",et,[v(A,{name:"dailyLimit",label:"Enter daily limit",type:"currency"}),v(A,{name:"absoluteLimit",label:"Enter absolute limit",type:"currency"}),v(A,{name:"withdrawLimit",label:"Enter withdraw limit",type:"currency"})]),t("div",st,[t("button",{type:"button",class:"btn btn-secondary",onClick:i[1]||(i[1]=f=>e.$emit("close"))}," Cancel "),i[4]||(i[4]=t("button",{type:"submit",class:"btn btn-primary"}," Save Changes ",-1))])],32)])])]),i[5]||(i[5]=t("div",{class:"modal-backdrop fade show"},null,-1))]))}},it={key:0,class:"container my-5"},ot={class:"d-flex justify-content-between align-items-center mb-4"},nt=["disabled"],lt={class:"d-flex gap-2"},rt=["disabled"],ut=["disabled"],ct={key:0,class:"alert alert-danger text-center"},dt={key:1,class:"table table-light table-bordered table-hover text-center align-middle"},mt=["onClick"],bt={key:1},pt={"aria-label":"Page navigation example",class:"d-flex justify-content-center mt-4 align-items-center gap-3"},ft=["disabled"],vt={class:"text-muted fw-semibold"},yt=["disabled"],_t=10,ht={__name:"AccountsList",setup(L){const b=M(),s=U(),g=q(),u=_(0),a=_(null),p=_(!1),m=_(null);function e(y){a.value=y}function i(){a.value&&(p.value=!0)}async function f(){await j.delete(z.closeAccount(a.value.iban),{headers:{Authorization:`Bearer ${b.token}`}})}async function P(y){try{(await s.updateAccountLimits(y)).status===200?(p.value=!1,await k(),a.value=null,m.value.setToast("Account Limits Updated Successfully","success")):m.value.setToast("Failed to update account limits","error")}catch{m.value.setToast("Failed to update account limits","error")}}async function k(){s.fetchAllAccounts(u.value,_t)}N(u,k,{immediate:!0});function T(){u.value>0&&u.value--}function E(){s.isLastPage.value||u.value++}function B(){a.value&&g.push({name:D.EMPLOYEE_TRANSACTIONS,params:{accountId:a.value.id},query:{iban:a.value.iban}})}return(y,o)=>(l(),r(C,null,[n(b).isAuthenticated&&n(b).isEmployee?(l(),r("div",it,[t("div",ot,[o[1]||(o[1]=t("h1",{class:"h2 m-0"},"Customer Accounts",-1)),t("button",{class:"btn btn-danger",onClick:f,disabled:!a.value}," Close Account ",8,nt),t("div",lt,[t("button",{class:"btn btn-primary",onClick:i,disabled:!a.value}," Update Account Limits ",8,rt),t("button",{class:"btn btn-primary",disabled:!a.value,onClick:B}," View Transactions ",8,ut)])]),n(s).error?(l(),r("div",ct,d(n(s).error),1)):(l(),r("table",dt,[o[3]||(o[3]=t("thead",{class:"table-success"},[t("tr",null,[t("th",null,"Customer Name"),t("th",null,"IBAN"),t("th",null,"Type"),t("th",null,"Balance")])],-1)),t("tbody",null,[n(s).userAccounts.length>0?(l(!0),r(C,{key:0},O(n(s).userAccounts,(c,R)=>(l(),r("tr",{key:R,class:Z(["clickable-row",{"table-active":a.value?.iban===c.iban}]),onClick:wt=>e(c)},[t("td",null,d(c.firstName)+" "+d(c.lastName),1),t("td",null,d(c.iban),1),t("td",null,d(c.type),1),t("td",null,d(n(h)(c.balance)),1)],10,mt))),128)):(l(),r("tr",bt,o[2]||(o[2]=[t("td",{colspan:"4",class:"text-center text-muted fw-semibold"}," No accounts found. ",-1)])))])])),t("nav",pt,[t("button",{class:"btn btn-outline-primary",onClick:T,disabled:n(s).isFirstPage,title:"Previous Page"},o[4]||(o[4]=[t("i",{class:"bi bi-chevron-left"},null,-1),S(" Previous ")]),8,ft),t("span",vt," Page "+d(u.value+1)+" of "+d(n(s).totalPages),1),t("button",{class:"btn btn-outline-primary",onClick:E,disabled:n(s).isLastPage,title:"Next Page"},o[5]||(o[5]=[S(" Next "),t("i",{class:"bi bi-chevron-right"},null,-1)]),8,yt)])])):x("",!0),p.value?(l(),V(at,{key:1,account:a.value,onClose:o[0]||(o[0]=c=>p.value=!1),onSubmit:P},null,8,["account"])):x("",!0),v(J,{ref_key:"toastRef",ref:m},null,512)],64))}},Lt=I(ht,[["__scopeId","data-v-c0e0c7cf"]]),gt={class:"container-fluid d-flex flex-column flex-grow-1 align-items-center p-0"},St={__name:"AccountsView",setup(L){return(b,s)=>(l(),r("main",gt,[v(Lt)]))}};export{St as default};
