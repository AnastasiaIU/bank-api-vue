import{r as c,y as $,c as p,d as b,g as n,l as E,t as P,s as U,p as D,a as j,q as I,A as g,h as m,f as q,w as z,i as f,F as C}from"./index-Ggau3Sma.js";import{A as V}from"./AccountDropdown-Swmc5oc0.js";import{c as M,h as O,i as R,j as x,u as K,_ as w}from"./rules-BYSljVp3.js";import{p as Y}from"./formatters-DwE89AP2.js";const Z={class:"mb-3"},G=["for"],H=["id"],S={__name:"TextInput",props:{id:{type:String,required:!0},label:{type:String,required:!0},modelValue:{type:String,default:""}},emits:["update:modelValue"],setup(u,{emit:s}){const o=u,v=s,i=c(o.modelValue||"");$(()=>o.modelValue,r=>{i.value=r||""});const A=()=>{const r=i.value.trim();v("update:modelValue",r)};return(r,l)=>(b(),p("div",Z,[n("label",{for:u.id,class:"form-label"},P(u.label),9,G),E(n("input",{id:u.id,type:"text",class:"form-control","onUpdate:modelValue":l[0]||(l[0]=d=>i.value=d),onBlur:A,placeholder:"Enter text"},null,40,H),[[U,i.value]])]))}},J=M({fromAccountIban:x,toAccountIban:x,amount:R,description:O().nullable()}),L={class:"d-flex flex-row justify-content-between"},Q=["disabled"],W={class:"mt-4"},X={key:0,class:"list-group"},tt=["disabled"],et={key:1,class:"text-center text-muted mt-3"},at={__name:"TransferBetweenUsers",props:{toast:Object},setup(u){const s=u,o=j(),{handleSubmit:v,meta:i,resetForm:A,setFieldValue:r}=K({validationSchema:J,initialValues:{fromAccountIban:"",toAccountIban:"",amount:"",description:""},validateOnMount:!0}),l=c(""),d=c(""),y=c([]),B=c([]),h=c(!1),_=c(0);async function T(){h.value=!1;const e=await I.get(g.accountsByName(l.value,d.value),{headers:{Authorization:`Bearer ${o.token}`}});h.value=!0,e.status===200?(y.value=e.data,await F()):s.toast.setToast("Failed to fetch IBANs. Please try again.","error")}async function F(){try{const e=await I.get(g.checkingAccountsById(o.user.id),{headers:{Authorization:`Bearer ${o.token}`}});B.value=e.data}catch{s.toast.setToast("Error getting your accounts. Please try again.","error")}}function k(){return!(l.value&&d.value)}const N=v(async e=>{if(!e.fromAccountIban){s.toast.setToast("Please select an IBAN to transfer from.","error");return}try{const t={sourceAccount:e.fromAccountIban,targetAccount:e.toAccountIban,initiatedBy:o.user.id,amount:Y(e.amount),description:e.description||null};(await I.post(g.transactions,t,{headers:{Authorization:`Bearer ${o.token}`}})).status===201?(s.toast.setToast("Transaction created successfully!","success"),A(),_.value++):s.toast.setToast("Failed to create transaction. Please try again.","error")}catch{s.toast.setToast("An error occurred while creating the transaction.","error")}});return(e,t)=>(b(),p(C,null,[t[5]||(t[5]=n("h1",{class:"h2 text-center"},"Find IBAN",-1)),n("div",null,[n("div",L,[m(S,{id:"firstName",label:"Enter first name",modelValue:l.value,"onUpdate:modelValue":t[0]||(t[0]=a=>l.value=a)},null,8,["modelValue"]),m(S,{id:"lastName",label:"Enter last name",modelValue:d.value,"onUpdate:modelValue":t[1]||(t[1]=a=>d.value=a)},null,8,["modelValue"])]),n("button",{class:"btn btn-primary mt-3 w-100",onClick:T,disabled:k()},"Find IBAN",8,Q)]),n("div",W,[y.value.length?(b(),p("div",X,[(b(),p("form",{key:_.value,onSubmit:t[4]||(t[4]=z((...a)=>f(N)&&f(N)(...a),["prevent"])),class:"d-flex flex-column gap-2"},[m(V,{accounts:B.value,label:"Select your account:","onUpdate:selectedAccount":t[2]||(t[2]=a=>f(r)("fromAccountIban",a?a.iban:""))},null,8,["accounts"]),m(V,{accounts:y.value,label:"IBANs found:","onUpdate:selectedAccount":t[3]||(t[3]=a=>f(r)("toAccountIban",a?a.iban:"")),balanceVisible:!1},null,8,["accounts"]),m(w,{name:"amount",label:"Amount to Transfer",type:"currency"}),m(w,{name:"description",label:"Description"}),n("button",{class:"btn btn-primary",type:"submit",disabled:!f(i).valid},"Transfer",8,tt)],32))])):h.value?(b(),p("div",et," No IBANs found for the given name. ")):q("",!0)])],64))}},lt=D(at,[["__scopeId","data-v-cd23e9d6"]]);export{lt as F,J as t};
